# 04. 맥미니 클러스터 확장 전략

단일 기기의 물리적 한계를 극복하고, 여러 대의 Mac mini를 하나의 고성능 AI 워크스테이션처럼 활용하기 위한 클러스터링 전략입니다.

## 1. 클러스터링의 핵심 목적

멀티 에이전시 및 AI 개발 환경에서 Mac mini 클러스터링은 단순히 속도 향상을 넘어 다음과 같은 전략적 가치를 제공합니다.

### ① 메모리 한계 돌파 (VRAM의 수평적 확장)
- **전략**: `Exo`와 같은 분산 추론 도구를 사용하여 여러 기기의 Unified Memory를 통합합니다.
- **효과**: 24GB Mac mini 3대를 연결할 경우 약 72GB의 가용 VRAM을 확보하여, 단일 기기에서는 불가능한 **Llama 3.1 70B**나 **DeepSeek-V3** 같은 초대형 모델을 로컬에서 구동할 수 있습니다.

### ② 연산 자원의 격리 및 병렬화 (Workload Isolation)
- **전략**: 각 노드에 고정된 역할을 부여하여 병목 현상을 방지합니다.
    - **Node 1**: 게이트웨이(Router), 벡터 데이터베이스(Chroma/Milvus)
    - **Node 2**: 메인 개발 에이전트(Ollama/vLLM - Qwen3-32B)
    - **Node 3**: 설계자 에이전트(Planner - Qwen3-Next-80B or Exo Cluster)
- **효과**: 특정 에이전트의 무거운 연산 중에도 전체 시스템의 반응성을 유지하며, 에이전트 간 병렬 협업이 가능해집니다.

### ③ 썬더볼트 기반 "가상 단일 워크스테이션"
- **전략**: 썬더볼트 브릿지(40Gbps)와 NFS/SSHFS를 결합하여 데이터 레이어를 통합합니다.
- **효과**: 여러 대의 기기에 분산된 데이터와 소스 코드를 지연 시간 없이 마치 하나의 드라이브처럼 공유하여 개발 환경의 일관성을 유지합니다.

## 2. 시스템 아키텍처 (예시)

| 구성 요소 | 하드웨어 | 주요 역할 | 비고 |
| :--- | :--- | :--- | :--- |
| **Master Node** | M4 Pro (64GB) | 에이전트 오케스트레이션, UI, 메인 개발 | 중심 관제소 |
| **Inference Node** | M4 (24GB) x N | 거대 모델 분산 추론 (Exo Cluster) | VRAM 확장용 |
| **Storage/DB Node** | M4 (16GB+) | 벡터 DB, 기술 문서 저장소, 로그 분석 | I/O 최적화 |

## 3. 실무 운용 가이드: "효율의 임계점"

클러스터링 구성 시 다음의 '성능의 역설'을 고려하여 최적의 시나리오를 선택해야 합니다.

1.  **용량(Capacity) vs 속도(Speed)**:
    - 클러스터링은 **'속도'**보다는 **'체급'**을 키우는 작업입니다.
    - 32B 이하 모델은 단일 기기에서 구동하는 것이 빠르며, 70B 이상의 모델에서만 클러스터링을 활성화하는 것이 유리합니다.
2.  **모델 배치 전략**:
    - **상주 모델**: 자주 호출되는 Router(7B), Dev(32B)는 개별 노드에 상주시켜 즉각적인 응답을 유도합니다.
    - **온디맨드 모델**: Planner(80B+)와 같은 무거운 모델은 필요 시에만 클러스터링 자원을 점유하도록 설계합니다.

## 4. 향후 확장 로드맵

- [ ] **자동화 스크립트 구축**: 썬더볼트 연결 시 자동으로 클러스터링 노드를 인식하고 역할을 배분하는 스크립트 작성.
- [ ] **로드 밸런싱 최적화**: 에이전트의 작업 부하에 따라 추론 노드를 동적으로 할당하는 라우팅 로직 고도화.
- [ ] **모니터링 대시보드**: 각 노드의 GPU/Memory 점유율을 한눈에 파악할 수 있는 Grafana 대시보드 연동.

---
**관련 문서**:
- [Appendix 02. 분산 추론 및 고급 네트워크 설정](../99_Appendix/02_분산_추론_및_고급_네트워크_설정.md)
- [System Design 01. Qwen3 모델 구성 전략](./01_Qwen3_모델_구성_전략.md)
