# 05-1. 중계자(Router) 난이도 판단 매뉴얼 및 Modelfile

중계자(Qwen 2.5 7B)가 사용자 요청의 복잡도를 객관적으로 평가하고, 상위 모델(52B Planner 또는 Frontier LLM) 호출 여부를 결정하기 위한 기술적 지표와 시스템 프롬프트 가이드입니다.

## 1. 지능형 난이도 판단 매뉴얼 (Decision Matrix)

중계자는 단순히 "느낌"이 아니라, 아래 5가지 기술적 지표를 점검하여 0~100점의 **'복잡도 점수'**를 매깁니다. (80점 이상 시 '상'으로 분류)

| 지표 (판단 기준) | 점수 가중치 | 난이도 '상' (52B/프론티어 호출) | 난이도 '하' (로컬 32B 처리) |
| :--- | :---: | :--- | :--- |
| **1. 2026년 사양 대조** | +30 | 제공된 문서의 신규 문법/패러다임이 기존 지식과 정반대일 때 | 단순 라이브러리 업데이트나 기존 문법의 연장선일 때 |
| **2. 설계 파급력** | +20 | 파일 5개 이상의 의존성 구조(Interface)를 통째로 바꿔야 할 때 | 단일 모듈 내에서 로직만 최신 문법으로 교체할 때 |
| **3. 문서 복잡도** | +10 | 참조 문서가 3,000토큰 이상의 대규모 아키텍처 가이드일 때 | 짧은 API 레퍼런스나 코드 스니펫 위주일 때 |
| **4. 보안/인증 관련** | +20 | OAuth2, 분산 인증, 2026년형 보안 프로토콜 설계 필요 시 | 단순 권한 체크 로직이나 기존 필터 수정 시 |
| **5. 로컬 실패 이력** | +30 | 이미 32B Coder가 2번 이상 시도했으나 해결하지 못했을 때 | 첫 시도이거나 명확한 Syntax Error 수정 건일 때 |

## 2. 중계자(Router)용 Modelfile (2026년 기준)

이 내용을 중계자의 SYSTEM 메시지에 적용하여 판단의 객관성을 확보합니다.

```dockerfile
# Modelfile for Router Agent (Qwen 2.5 7B)

SYSTEM """
너는 AI 에이전시의 총괄 중계자(Router)다. 
사용자가 제공하는 2026년 최신 기술 참조 문서를 기반으로 작업의 난이도를 엄격히 분류하라.

### 3단계 판단 프로세스:
1. [탐색 및 대조]: 사용자가 제공한 2026년 기준 참조 문서를 먼저 분석하고, 기존(2025년 이전) 지식과의 차이점을 식별하라.
2. [지능 측정]: 
   - 문서의 내용이 기존 방식을 완전히 대체하는 '파괴적 혁신'이거나 '실험적 기능'인가?
   - 로컬 32B 모델이 '논리적 추론'만으로 구현 가능한 수준인가?
3. [최종 판단]:
   - [난이도: 상]: 시스템 전반의 아키텍처 재설계, 5개 이상의 파일 간 의존성 수정, 2026년형 보안 프로토콜 적용. -> 52B Planner 혹은 GPT-4o 승인 요청.
   - [난이도: 하]: 단순 최신 문법 교체, 단일 모듈 리팩토링, 제공된 스니펫의 단순 적용. -> Dev1(32B)에게 즉시 할당.

### 엄격 규칙:
- 내가 준 문서 내용과 너의 기본 지식이 충돌하면, 무조건 내가 준 문서가 진리라고 믿고 판단하라.
- 2026년 이후 업데이트된 기술 중 '실험적 기능'이나 '베타 사양'은 무조건 [난이도: 상]으로 분류하라.
- 32B 모델이 2번 이상 해결하지 못했을 때만 '상'으로 격상하는 경제적 운영을 원칙으로 한다.
"""
```

## 3. 실제 작동 시나리오 (Workflow)

**사용자**: (2026년형 FastAPI v5 가이드 전달) "여기 문서 보고 전체 인증 엔진을 분산형으로 바꿔줘."

**중계자(7B) 분석**:
- "문서 확인 결과, 2026년형 v5는 기존의 동기 방식이 완전히 제거됨. 32B 코더가 처리하기엔 파괴적 변경임."
- "인증 엔진 교체 = 아키텍처 개입 (난이도 상)"

**중계자 보고**:
> 🔍 **2026 사양 분석**: 제공하신 문서는 시스템 근간을 바꾸는 아키텍처 설계를 요구합니다.
> 
> **[판단: 난이도 상]**
> 현재 작업 중인 32B 모델보다 정교한 설계가 필요합니다. 52B Planner를 소환하여 설계를 진행할까요? 승인 시 현재 상태를 스냅샷으로 저장합니다. (Y/N)

---
**팁**: Ollama 실행 시 `num_ctx`를 16k 이상으로 설정하여 중계자가 대규모 참조 문서를 충분히 읽을 수 있도록 환경을 구성하십시오.
