# 08. 실시간 에이전트 로그 모니터링 (Rich 활용)

멀티 에이전트 시스템이 작동할 때, 터미널에 에이전트들의 대화를 실시간으로 스트리밍하여 개발 프로세스를 시각화합니다. 이는 시스템의 투명성을 높이고 개발 생산성을 향상시키는 '보는 맛'이 있는 모니터링 시스템입니다.

## 1. Rich 라이브러리를 활용한 시각화

`rich` 라이브러리를 사용하면 터미널 출력의 가독성을 비약적으로 상승시킬 수 있습니다. 에이전트별로 다른 색상과 패널을 적용하여 대화 흐름을 한눈에 파악합니다.

```python
from rich.console import Console
from rich.panel import Panel
from rich.live import Live
from rich.layout import Layout

console = Console()

def log_agent_action(agent_name, message, color="cyan"):
    """
    에이전트의 활동을 실시간으로 터미널에 출력
    - agent_name: 활동하는 에이전트 이름 (Architect, Coder, Tester 등)
    - message: 출력할 내용
    - color: 패널 테두리 및 제목 색상
    """
    panel = Panel(
        message,
        title=f"[bold]{agent_name}[/bold]",
        border_style=color,
        padding=(1, 2)
    )
    console.print(panel)

# 사용 예시
if __name__ == "__main__":
    log_agent_action("Architect", "데이터베이스 스키마 설계를 시작합니다...", "purple")
    log_agent_action("Tester", "실패하는 테스트 케이스를 생성했습니다. (Red)", "red")
    log_agent_action("Coder", "테스트 통과를 위해 코드를 수정 중입니다...", "green")
```

## 2. 모니터링과 시스템 결합

에이전트가 도구를 사용하거나 단계를 전환할 때마다 로그를 찍어주면, 시스템이 스스로 코딩하는 모습을 실시간으로 감상할 수 있습니다.

```python
def run_agency():
    # Live 컨텍스트를 사용하여 화면을 동적으로 업데이트 (필요 시)
    with Live(console.print("[bold yellow]에이전시 가동 중...[/bold yellow]"), refresh_per_second=4):
        # 1. 아키텍트 단계
        log_agent_action("Architect", "요구사항 분석 중...", "purple")
        plan = call_architect(user_req)
        
        # 2. TDD 루프
        while not task_complete:
            log_agent_action("Tester", "테스트 실행 중...", "red")
            result = tools.run_test()
            
            if result['exit_code'] != 0:
                # 에러 로그의 일부를 추출하여 출력
                error_summary = result['log'][:100] + "..." if len(result['log']) > 100 else result['log']
                log_agent_action("Router", f"에러 발견: {error_summary}", "yellow")
                
                log_agent_action("Coder", "코드 수정 돌입", "green")
                call_coder_fix(result['log'])
            else:
                log_agent_action("System", "모든 테스트 통과! Git 커밋을 진행합니다.", "blue")
                tools.git_commit("feat: 기능 구현 완료")
                break
```

## 3. 기대 효과

1.  **실시간 피드백**: 시스템이 현재 어떤 단계에 있는지, 어떤 에러를 해결 중인지 즉시 파악 가능합니다.
2.  **디버깅 용이성**: 에이전트 간의 대화 흐름을 통해 논리적 결함이 발생하는 지점을 쉽게 찾을 수 있습니다.
3.  **심리적 안정감**: 복잡한 작업이 진행되는 동안 "시스템이 멈춘 것이 아니라 열심히 일하고 있다"는 것을 시각적으로 확인시켜 줍니다.
