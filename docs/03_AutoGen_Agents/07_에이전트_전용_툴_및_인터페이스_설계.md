# 07. ì—ì´ì „íŠ¸ ì „ìš© íˆ´ ë° ì¸í„°í˜ì´ìŠ¤ ì„¤ê³„

ì—ì´ì „íŠ¸ê°€ ë‹¨ìˆœíˆ í…ìŠ¤íŠ¸ë¥¼ ìƒì„±í•˜ëŠ” ìˆ˜ì¤€ì„ ë„˜ì–´, í˜¸ìŠ¤íŠ¸ ì‹œìŠ¤í…œì˜ íŒŒì¼ì„ ìˆ˜ì •í•˜ê³  Git ëª…ë ¹ì„ ì‹¤í–‰í•˜ë©° ìƒŒë“œë°•ìŠ¤ ë‚´ë¶€ì—ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ëŒë¦¬ê¸° ìœ„í•œ **'Agent Tools(Function Calling)'** ì¸í„°í˜ì´ìŠ¤ë¥¼ ì„¤ê³„í•©ë‹ˆë‹¤.

## 1. íˆ´ ìŠ¤í™ (Tool Spec)

ì—ì´ì „íŠ¸ëŠ” ì•„ë˜ì™€ ê°™ì€ JSON í˜•ì‹ì„ ì¶œë ¥í•˜ì—¬ ë„êµ¬ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. ì¤‘ê³„ì(Router)ëŠ” ì´ ìš”ì²­ì„ í•´ì„í•˜ì—¬ ì‹¤ì œ íŒŒì´ì¬ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

```json
{
  "tool": "write_file",
  "params": {
    "path": "app/auth.py",
    "content": "def login()..."
  }
}
```

## 2. í•µì‹¬ íˆ´ êµ¬í˜„ (Python Skills)

`AgentTools` í´ë˜ìŠ¤ëŠ” ì—ì´ì „íŠ¸ì˜ ìš”ì²­ì„ ë°›ì•„ ì‹¤ì œ íŒŒì¼ ì‹œìŠ¤í…œê³¼ Docker ìƒŒë“œë°•ìŠ¤ë¥¼ ì—°ê²°í•˜ëŠ” ê°€êµ ì—­í• ì„ í•©ë‹ˆë‹¤.

```python
import os
import subprocess

class AgentTools:
    def __init__(self, project_root, container):
        """
        project_root: í˜¸ìŠ¤íŠ¸ì˜ í”„ë¡œì íŠ¸ ì ˆëŒ€ ê²½ë¡œ
        container: ìƒì£¼ ì¤‘ì¸ Docker ì»¨í…Œì´ë„ˆ ê°ì²´
        """
        self.root = project_root
        self.container = container

    def write_file(self, path, content):
        """ë¡œì»¬ Git ë””ë ‰í† ë¦¬ì— íŒŒì¼ ì‘ì„±"""
        full_path = os.path.join(self.root, path)
        os.makedirs(os.path.dirname(full_path), exist_ok=True)
        with open(full_path, "w", encoding="utf-8") as f:
            f.write(content)
        return f"âœ… {path} íŒŒì¼ ì €ì¥ ì™„ë£Œ"

    def run_test(self, command="pytest"):
        """ìƒì£¼í˜• Docker ìƒŒë“œë°•ìŠ¤ì—ì„œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰"""
        # exec_runì€ 0.1ì´ˆ ë‚´ì™¸ë¡œ ê²°ê³¼ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
        exit_code, output = self.container.exec_run(command)
        return {
            "exit_code": exit_code,
            "output": output.decode('utf-8')
        }

    def git_commit(self, message):
        """í…ŒìŠ¤íŠ¸ ì„±ê³µ ì‹œ ìë™ ì»¤ë°‹ ìŠ¤í‚¬"""
        try:
            # -C ì˜µì…˜ì„ ì‚¬ìš©í•˜ì—¬ íŠ¹ì • ë””ë ‰í† ë¦¬ì—ì„œ git ëª…ë ¹ ì‹¤í–‰
            subprocess.run(["git", "-C", self.root, "add", "."], check=True)
            subprocess.run(["git", "-C", self.root, "commit", "-m", message], check=True)
            return "ğŸš€ Git ì»¤ë°‹ ì„±ê³µ!"
        except Exception as e:
            return f"âŒ Git ì—ëŸ¬: {str(e)}"
```

## 3. ììœ¨ ì£¼í–‰ ì‹œë‚˜ë¦¬ì˜¤: Git ì—ì´ì „íŠ¸

ì¤‘ê³„ì(Router)ì—ê²Œ "í…ŒìŠ¤íŠ¸ê°€ ì„±ê³µí•˜ë©´ ìë™ìœ¼ë¡œ Git Commitì„ ìˆ˜í–‰í•˜ë¼"ëŠ” ê·œì¹™(Skill)ì„ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- **Action Sequence**: `FIX_CODE` â†’ `TEST_PASS` â†’ `GIT_COMMIT`
- **ê²°ê³¼**: ì „ì²´ ê°œë°œ íˆìŠ¤í† ë¦¬ê°€ LLMì— ì˜í•´ ìë™ìœ¼ë¡œ ê¸°ë¡ë˜ëŠ” ììœ¨ ì£¼í–‰ ê°œë°œ ì‹œìŠ¤í…œì´ êµ¬ì¶•ë©ë‹ˆë‹¤.

## 4. ë³´ì•ˆ ë° í™•ì¥ì„±

1.  **ê²½ë¡œ ê²€ì¦**: `write_file` ì‹¤í–‰ ì‹œ `self.root`ë¥¼ ë²—ì–´ë‚œ ê²½ë¡œ(ì˜ˆ: `../../etc/passwd`)ì— ì ‘ê·¼í•˜ì§€ ëª»í•˜ë„ë¡ ê°•ë ¥í•œ ê²½ë¡œ ê²€ì¦ ë¡œì§ì´ í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
2.  **ëª…ë ¹ì–´ ì œí•œ**: `run_test`ì—ì„œ ì‹¤í–‰ ê°€ëŠ¥í•œ ëª…ë ¹ì–´ë¥¼ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸(pytest, pylint, black ë“±)ë¡œ ì œí•œí•˜ì—¬ ë³´ì•ˆì„ ê°•í™”í•©ë‹ˆë‹¤.
3.  **íˆ´ í™•ì¥**: í–¥í›„ `read_file`, `list_files`, `git_push` ë“±ì˜ ë„êµ¬ë¥¼ ì¶”ê°€í•˜ì—¬ ì—ì´ì „íŠ¸ì˜ ììœ¨ì„±ì„ ë”ìš± í™•ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
