# 11. 회사망 로컬 서버 노출 가이드

Cursor는 모든 요청을 자사 서버를 거쳐 전달하기 때문에 **HTTPS**로 접근 가능한 엔드포인트가 필요합니다. 회사망에서는 `http://100.x.x.x:8000` 같은 Tailscale 사설 IP나 HTTP 트래픽이 차단되는 경우가 많아, **공인 HTTPS 도메인**으로 로컬 LiteLLM/Ollama를 노출해야 합니다.

이 문서는 회사 노트북의 Cursor에서 개인 PC(또는 맥미니)의 로컬 서버에 안전하게 접속하기 위한 **HTTPS 터널 대안**을 분류별로 정리합니다.

---

## 1. Tailscale Funnel 사용 (가장 추천)

Tailscale의 **Funnel** 기능을 사용하면 로컬에서 실행 중인 LiteLLM 서버를 공인된 HTTPS 도메인(예: `node-name.tail-net.ts.net`)으로 노출할 수 있습니다.

### 장점

- 100.x 대역이 아닌 **공인 도메인**을 사용합니다.
- **TLS(HTTPS/443)** 암호화가 적용되어 HTTP 필터링을 통과할 확률이 매우 높습니다.

### 설정 방법

1. **개인 PC**(로컬 서버가 돌아가는 맥미니/맥북)에서 Tailscale Funnel을 활성화합니다.
2. 로컬 서비스를 노출합니다.

```bash
# LiteLLM 포트(8000)를 노출하는 경우
tailscale serve 8000

# Ollama만 사용하는 경우
tailscale serve 11434
```

3. **회사 노트북**의 Cursor에서 `http://100.x.x.x:8000` 대신 **`https://your-node.tail-net.ts.net`** 을 엔드포인트로 설정합니다.
   - LiteLLM(OpenAI 형식) 사용 시: Base URL에 `/v1`을 붙여 `https://your-node.tail-net.ts.net/v1` 로 설정합니다.
   - Ollama 직접 사용 시: `https://your-node.tail-net.ts.net` (Funnel이 해당 포트를 노출).

> **참고**: Funnel으로 노출된 주소는 Tailscale 앱 또는 `tailscale status` 출력에서 확인할 수 있습니다.

---

## 2. SSH Reverse Tunneling (TCP 443/22 활용)

회사망에서 외부 특정 서버로의 **SSH 접속이 허용**된다면, SSH 터널링을 통해 트래픽을 일반 웹 트래픽처럼 보이게 할 수 있습니다.

### 방법

- **외부 클라우드**(AWS 라이트세일 등)를 중계지로 활용하거나, 개인 PC와 회사 노트북 사이에 직접 터널을 뚫습니다.
- 포트를 **443(HTTPS)**으로 설정하여 일반 웹 트래픽처럼 보이게 만드는 것이 핵심입니다.

### 요약

- 상세 설정(역방향 터널 명령어, 중계 서버 설정)은 사용 중인 클라우드/SSH 환경에 따라 다르므로, 공식 SSH 터널링 문서를 참고하세요.

---

## 3. Cloudflare Tunnel (Zero Trust) 활용

Tailscale이 완전히 막혔을 때 **가장 강력한 대안**입니다.

### 설정 요약

1. 개인 PC에 **cloudflared**를 설치합니다.
2. LiteLLM(또는 Ollama) 포트를 Cloudflare Tunnel에 연결합니다.
3. **`https://llm.yourdomain.com`** 같은 일반적인 웹 주소가 생성됩니다.

### 효과

- 대부분의 회사 보안 솔루션은 **Cloudflare의 엣지 서버 IP**를 신뢰하기 때문에 필터링을 통과하기 쉽습니다.
- 별도의 포트 포워딩 없이 보안 필터를 우회하는 데 최적화되어 있습니다.

상세 설정은 [Cloudflare Zero Trust 문서](https://developers.cloudflare.com/cloudflare-one/connections/connect-apps/)를 참고하세요.

---

## 4. Tailscale 설정 변경 (포트 443 강제)

회사가 **특정 포트만 허용**하는 경우, Tailscale이 사용하는 포트를 표준 웹 포트(443)로 우회해볼 수 있습니다.

- Tailscale 클라이언트/서버 설정에서 리스닝 포트를 443으로 지정하는 방식으로, 회사 방화벽이 443만 열어둔 환경에서 연결 가능성을 높일 수 있습니다.
- 자세한 옵션은 [Tailscale 문서](https://tailscale.com/kb/1082/firewall-ports/)를 참고하세요.

---

## 5. 기타 팁

- **Tailscale 앱 실행이 회사 노트북에서 차단**된 경우:
  - **Tailscale Web Client** 또는 **SOCKS5 프록시** 설정을 통해, 브라우저나 특정 앱(Cursor)의 트래픽만 Tailscale 망으로 태우는 방법을 고려할 수 있습니다.
- 이 경우 Cursor에서 프록시를 경유해 Tailscale Funnel 주소로 접속하도록 설정하면 됩니다.

---

## 6. 요약 및 추천 앱

| 앱 명칭 | 주요 기능 및 역할 |
| :--- | :--- |
| **Cloudflare Zero Trust** | 로컬 서버를 안전한 공인 HTTPS 도메인으로 즉시 매핑해 줍니다. 별도의 포트 포워딩 없이 보안 필터를 우회하는 데 최적화되어 있습니다. |
| **Proxyman** (또는 **Charles**) | 회사 노트북에서 어떤 패킷이 차단되는지 디버깅할 때 유용합니다. 트래픽의 목적지와 필터링 지점을 정확히 파악할 수 있습니다. |

현 상황에서 가장 깔끔한 해결책은 **Tailscale Funnel**을 먼저 시도하고, 실패 시 **Cloudflare Tunnel**을 병행하는 것입니다.

---

## 7. 가장 먼저 시도할 단계

1. **개인 PC**에서 Tailscale Funnel을 켜서 HTTPS 주소를 생성한 뒤, **Cursor**에서 해당 주소로 접속해 봅니다.
2. 이 방법이 **실패**하면 **Cloudflare Tunnel** 설정법을 적용합니다. (위 3절 및 Cloudflare 공식 문서 참고)

---

## 관련 문서

- [07. Tailscale 기반 Ollama 원격 접속](./07_Tailscale_기반_Ollama_원격_접속.md) – Tailscale 기본 구성 및 100.x 접속
- [08. LiteLLM – OpenAI 호환 프록시](./08_LiteLLM_OpenAI_호환_프록시.md) – LiteLLM 포트 및 OpenAI 형식 엔드포인트
- [10. Cursor + ngrok 로컬 Ollama 연동 가이드](./10_Cursor_ngrok_로컬_Ollama_연동.md) – ngrok HTTPS 터널 기본 설정
