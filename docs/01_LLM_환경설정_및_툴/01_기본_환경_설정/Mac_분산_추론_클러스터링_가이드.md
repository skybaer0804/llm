# Mac 분산 추론(Distributed Inference) 클러스터링 가이드

M4 Pro Mac mini와 M2 MacBook Air를 연결하여 하나의 슈퍼컴퓨터처럼 사용하는 방법입니다. 이를 통해 통합 메모리를 합쳐 거대한 모델을 구동하거나 처리 속도를 높일 수 있습니다.

---\n\n## 1. 주요 도구: Exo (추천)
현재 Apple Silicon 환경에서 가장 강력하고 설정이 쉬운 도구는 **Exo (by ExoLabs)**입니다.

- **자동 샤딩(Sharding):** 여러 대의 Mac을 연결하면 기기를 자동으로 감지하여 모델을 나누어 로드합니다.
- **유연한 하이브리드 구성:** M4 Pro와 M2 Air처럼 사양이 다른 기기도 함께 묶을 수 있습니다.
- **최적화:** MLX 라이브러리를 기반으로 Apple Silicon 성능을 극대화합니다.
- **성능 팁:** 썬더볼트 케이블로 직접 연결 시 네트워크(Wi-Fi/이더넷)보다 훨씬 낮은 지연 시간으로 데이터를 주고받을 수 있습니다.

---\n\n## 2. 클러스터 구성 및 실행 방법

### 설치
각 기기의 터미널에서 아래 명령어를 실행하여 설치합니다.
```bash
curl -fsSL https://install.exo.sh | sh
```

### 기기 연결 및 실행
1. **연결:** 두 대의 Mac을 동일한 Wi-Fi에 두거나, 최상의 성능을 위해 **썬더볼트 케이블**로 직접 연결합니다.
2. **실행:** 양쪽 기기에서 `exo`를 실행하면 서로를 자동으로 찾습니다.
3. **모델 구동:** 메인 기기(M4 Pro)에서 모델을 실행하면 작업이 분산됩니다.
   ```bash
   # 예: 32B 모델 실행
   exo run qwen2.5-coder:32b
   ```

---\n\n## 3. 클러스터링의 이득과 주의사항
- **메모리 확장:** M4 Pro(64GB) + M2 Air(16GB) 구성 시 약 **80GB의 통합 메모리**를 확보하여, 단일 기기에서 어려운 70B 이상의 대형 모델을 안정적으로 구동할 수 있습니다.
- **병목 현상:** 데이터 전송 속도가 병목이 될 수 있습니다. 32B 이하 모델은 M4 Pro 단독 실행이 더 빠를 수 있으나, 초거대 모델에서는 클러스터링이 필수적입니다.

---\n\n## 4. 썬더볼트 브릿지 설정 (초고속 네트워크)
두 Mac을 썬더볼트 케이블로 연결했을 때, 이를 초고속 통로로 인식하게 만드는 설정입니다. 두 기기 모두 진행해 주세요.

### ① 브릿지 활성화
1. `시스템 설정` → `네트워크`로 이동합니다.
2. 우측 하단 아이콘(`...`) 클릭 → `가상 인터페이스 관리...` 선택.
3. `+` 버튼 클릭 → `새로운 Thunderbolt 브릿지...` 선택 후 생성 및 완료.

### ② 서비스 순서 설정 (중요)
Wi-Fi보다 유선 썬더볼트를 우선 사용하도록 설정합니다.
1. `네트워크` 창 하단 `...` 아이콘 클릭 → `서비스 순서 설정...` 선택.
2. `Thunderbolt 브릿지`를 맨 위(Wi-Fi보다 위)로 드래그하고 적용합니다.

### ③ 고정 IP 할당 (연결 속도 향상)
1. `Thunderbolt 브릿지` → `세부사항...` → `TCP/IP` 탭 선택.
2. `IPv4 구성`을 **수동**으로 변경합니다.
   - **M4 Pro Mac:** IP `192.168.2.1` / 서브넷 마스크 `255.255.255.0`
   - **M2 Air:** IP `192.168.2.2` / 서브넷 마스크 `255.255.255.0`
3. 확인 후 저장합니다.

---\n\n## 5. 자주 묻는 질문 (FAQ)
**Q: 노트북을 외부로 가져갔다가 다시 연결해도 되나요?**
A: 네, 문제없습니다. Exo는 노드의 동적 추가 및 제거를 지원합니다. 노트북을 다시 연결하고 `exo`를 실행하면 메인 장비가 이를 즉시 인식합니다. 단, 분리 전 실행 중인 추론 작업은 잠시 멈추는 것이 안전합니다.

---\n*참고 자료:*\n- [Exo by ExoLabs - Distributed AI Computing](https://dev.to)\n- [M4 Mac Mini Cluster Guide](https://youtube.com)
