# 02. 24시간 자동 운영 및 모니터링

시스템을 24시간 중단 없이 운영하기 위한 macOS 최적화 설정과 실시간 모니터링 환경을 구축합니다.

## 1. macOS 서버 최적화 설정

Mac M4 Pro를 서버 용도로 상시 가동하기 위한 설정입니다.

- **디스플레이 절전**: 시스템 설정 → 화면 시간 초과 → 디스플레이 끄기 (15분 후).
- **컴퓨터 절전 방지**: 시스템 설정 → 에너지 절약 → **"디스플레이가 꺼져 있을 때 컴퓨터를 자동으로 잠자게 하지 않음"** 체크.
- **자동 재시작**: 시스템 설정 → 에너지 절약 → **"정전 후 자동으로 시작"** 체크.

## 2. 프로세스 데몬화 (launchd)

AutoGen 모니터링 스크립트와 LLM 라우터를 재부팅 후에도 자동으로 실행되게 합니다.

`~/Library/LaunchAgents/com.autogen.monitor.plist` 예시:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>Label</key>
    <string>com.autogen.monitor</string>
    <key>ProgramArguments</key>
    <array>
        <string>/Users/yourname/my-autogen-project/.venv/bin/python</string>
        <string>/Users/yourname/my-autogen-project/monitor.py</string>
    </array>
    <key>RunAtLoad</key>
    <true/>
    <key>KeepAlive</key>
    <true/>
    <key>WorkingDirectory</key>
    <string>/Users/yourname/my-autogen-project</string>
</dict>
</plist>
```
*적용*: `launchctl load ~/Library/LaunchAgents/com.autogen.monitor.plist`

## 3. 실시간 시스템 모니터링

### 리소스 확인
- **CPU/RAM**: `top -u` 또는 활성 상태 보기(Activity Monitor).
- **GPU (Apple Silicon)**: `powermetrics --samplers gpu_power -n 1` 명령으로 GPU 부하 확인.

### 로그 확인
- **라우터 로그**: `tail -f /tmp/router.log`
- **Ollama 로그**: `log stream --predicate 'process == "ollama"' --level debug`
- **Docker 로그**: `docker logs -f open-webui`

## 4. 유지보수 스케줄

| 주기 | 작업 내용 |
| :--- | :--- |
| **매일** | 라우터 로그 확인 및 비정상 종료 여부 체크 |
| **매주** | `docker system prune`으로 미사용 데이터 정리, 시스템 재부팅 권장 |
| **매월** | `brew update && brew upgrade`로 Ollama 및 도구 버전 최신화 |
