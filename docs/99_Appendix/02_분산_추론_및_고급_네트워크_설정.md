# 02. 분산 추론 및 고급 네트워크 설정

단일 기기(M4 Pro)의 한계를 넘어 여러 대의 Mac을 연결하거나, 원격 환경에서 효율적으로 개발하기 위한 고급 설정 가이드입니다. 

> **참고**: 이 가이드의 전략적 활용 방안에 대해서는 [04. 맥미니 클러스터 확장 전략](../02_System_Design/04_맥미니_클러스터_확장_전략.md) 문서를 참조하십시오.

## 1. 썬더볼트 네트워킹 (Thunderbolt Bridge)

두 대의 Mac을 썬더볼트 케이블로 연결하여 초고속(최대 40Gbps) 전용 네트워크를 구축하는 방법입니다.

### ① 브릿지 활성화
1. `시스템 설정` → `네트워크` → `...` 아이콘 → `가상 인터페이스 관리...`
2. `+` 버튼 클릭 → `새로운 Thunderbolt 브릿지...` 생성.

### ② 고정 IP 할당 (권장)
연결의 안정성을 위해 수동으로 IP를 지정합니다.
- **메인 Mac (M4 Pro)**: `192.168.2.1`
- **보조 Mac (MacBook)**: `192.168.2.2`
- **서브넷 마스크**: `255.255.255.0`

## 2. Exo를 활용한 분산 추론 (Clustering)

여러 대의 Apple Silicon Mac의 메모리를 합쳐 거대 모델(70B 이상)을 구동하는 기술입니다.

### 설치 및 실행
```bash
# 각 기기에서 설치
curl -fsSL https://install.exo.sh | sh

# 각 기기에서 실행 (서로 자동 감지)
exo run qwen2.5-coder:32b
```

### ⚠️ 성능의 역설 (주의사항)
- 두 기기를 연결하면 가용 메모리는 늘어나지만, 네트워크 대역폭 한계로 인해 **추론 속도는 단일 기기보다 느려질 수 있습니다.**
- 64GB 단일 기기에서 구동 가능한 모델(32B 이하)은 클러스터링을 하지 않는 것이 성능상 유리합니다.

## 3. 원격 파일 시스템 마운트 (NFS/SSHFS)

맥북에서 맥미니의 프로젝트 폴더를 로컬처럼 다루기 위한 설정입니다.

- **방법**: 맥미니의 폴더를 NFS 또는 SSHFS로 공유하고, 맥북에서 이를 마운트합니다.
- **이점**: 맥북의 Cursor나 IDE가 맥미니의 파일 전체 맥락을 파악할 수 있어, 실제 연산은 맥미니에서 수행하되 개발 경험은 맥북에서 쾌적하게 유지할 수 있습니다.

## 4. 고급 GPU 메모리 튜닝 (다시보기)

분산 추론에 참여하는 모든 기기(특히 메모리가 적은 기기)에서 GPU 가용량을 극대화해야 병목을 줄일 수 있습니다.
```bash
# 예: 24GB 모델인 경우 약 21GB 할당
sudo sysctl iogpu.wired_limit_mb=21504
```
